generator client {
  provider = "prisma-client-js"
  //output   = "../app/generated/prisma"
}

// @ts-ignore
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model batch_coments {
  id             Int            @id @default(autoincrement())
  batche_id      Int
  user_nick      String         @db.VarChar
  date           DateTime       @default(now()) @db.Timestamp(6)
  text           String
  cheese_batches cheese_batches @relation(fields: [batche_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users          users          @relation(fields: [user_nick], references: [nick_name], onDelete: NoAction, onUpdate: NoAction)
}

model batch_notes {
  id             Int            @id @default(autoincrement())
  batche_id      Int
  date           DateTime?      @default(now()) @db.Timestamp(6)
  title          String
  text           String?
  cheese_batches cheese_batches @relation(fields: [batche_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model cart {
  user_nick   String       @id @db.VarChar
  total_price Decimal?     @db.Decimal(10, 2)
  cart_items  cart_items[]
  users       users        @relation(fields: [user_nick], references: [nick_name])
}

model cart_items {
  id         Int    @id @default(autoincrement())
  cart_nick  String
  product_id Int
  quantity   Int

  cart     cart     @relation(fields: [cart_nick], references: [user_nick])
  products products @relation(fields: [product_id], references: [id])

  @@unique([cart_nick, product_id])
}

model cheese_batches {
  id            Int             @id @default(autoincrement())
  recipe_id     Int
  user_nick     String          @db.VarChar
  date_batch    DateTime?       @default(now()) @db.Timestamp(6)
  created_at    DateTime?       @db.Date
  ready_at      DateTime?       @db.Date
  description   String?
  foto          String?         @db.Text
  cheeseweight  Decimal?        @db.Decimal(10, 3)
  ispublic      Boolean?        @default(false)
  onTimeLine    Boolean         @default(true) //added this field to display the cheese ripening schedule
  batch_coments batch_coments[]
  batch_notes   batch_notes[]
  recipes       recipes         @relation(fields: [recipe_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users         users           @relation(fields: [user_nick], references: [nick_name], onDelete: NoAction, onUpdate: NoAction)
  milk_in_batch milk_in_batch[]
}

model favorite_recipes {
  recipe_id Int
  user_nick String  @db.VarChar
  recipes   recipes @relation(fields: [recipe_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users     users   @relation(fields: [user_nick], references: [nick_name], onDelete: NoAction, onUpdate: NoAction)

  @@id([recipe_id, user_nick])
}

model ingredients {
  id                 Int                  @id @default(autoincrement())
  name               String?
  type               ingredients_type     @default(Other)
  description        String?
  unit               String?              @db.VarChar(10)
  milk_in_batch      milk_in_batch[]
  recipe_ingredients recipe_ingredients[]
}

model milk_in_batch {
  batch_id       Int
  milk_id        Int
  amount         Int?
  cheese_batches cheese_batches @relation(fields: [batch_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ingredients    ingredients    @relation(fields: [milk_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([batch_id, milk_id])
}

model orders {
  id                Int           @id @default(autoincrement())
  user_nick         String?
  email             String
  date              DateTime      @default(now())
  total_price       Decimal       @db.Decimal(10, 2)
  delivery_price    Decimal       @default(0) @db.Decimal(10, 2)
  discount          Decimal?      @db.Decimal(10, 2)
  comment           String?       @db.VarChar(500)
  street            String
  zip               String
  city              String
  country           String
  phone             String?
  status            order_status  @default(pending)
  payment_status    String        @default("pending")
  paypal_order_id   String?       @unique
  stripe_session_id String?       @unique
  payment_method    String?
  order_items       order_items[]
  users             users?        @relation(fields: [user_nick], references: [nick_name])
}

model order_items {
  id          Int     @id @default(autoincrement())
  order_id    Int
  product_id  Int
  quantity    Int
  total_price Decimal @db.Decimal(10, 2)

  orders   orders   @relation(fields: [order_id], references: [id])
  products products @relation(fields: [product_id], references: [id])

  @@unique([order_id, product_id])
}

model products {
  id                  Int                 @id @default(autoincrement())
  name                String
  category_id         Int
  description         String?
  price               Decimal             @db.Decimal(10, 2)
  avaible             Boolean?
  image_url           String?
  image_id            String?
  isPublic            Boolean             @default(false)
  cart_items          cart_items[]
  order_items         order_items[]
  products_categories products_categories @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model products_categories {
  id       Int        @id @default(autoincrement())
  name     String
  body     String?
  products products[]
}

model recipe_ingredients {
  recipe_id     Int
  ingredient_id Int
  amount        Float?
  ingredients   ingredients @relation(fields: [ingredient_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  recipes       recipes     @relation(fields: [recipe_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([recipe_id, ingredient_id])
}

model recipes {
  id                 Int                  @id @default(autoincrement())
  category_id        Int
  name               String
  description        String?
  body               String?
  created_at         DateTime?            @db.Timestamp(6)
  aging              Int?
  image              String?
  ispublic           Boolean?             @default(false)
  cheese_batches     cheese_batches[]
  favorite_recipes   favorite_recipes[]
  recipe_ingredients recipe_ingredients[]
  recipes_categories recipes_categories   @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model recipes_categories {
  id      Int       @id @default(autoincrement())
  name    String
  body    String?
  recipes recipes[]
}

model subscribe {
  email String @id @db.VarChar(250)
}

model users {
  nick_name        String             @id @db.VarChar(100)
  username         String             @db.VarChar(100)
  email            String             @unique @db.VarChar(250)
  password         String             @db.VarChar(250)
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  telefon          String?            @db.VarChar(30)
  user_status      user_status        @default(user)
  avatar           String?            @db.VarChar(250)
  mood             String?
  info             String?
  user_address     String?
  ispublic         Boolean?           @default(true)
  issubscribed     Boolean?           @default(true)
  batch_coments    batch_coments[]
  cart             cart?
  cheese_batches   cheese_batches[]
  favorite_recipes favorite_recipes[]
  orders           orders[]
}

enum ingredients_type {
  Milk
  Starter_culture @map("Starter culture")
  Salt
  Spice
  Additive
  Coating
  Concervant
  Colorant
  Enzyme
  Other
}

enum order_status {
  pending
  processing
  shipped
  delivered
  cancelled
  refunded
}

enum user_status {
  admin
  basic
  standard
  premium
  user
}
